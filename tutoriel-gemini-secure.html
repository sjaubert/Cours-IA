<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutoriel Complet : Gemini (IA) + Google Drive Sécurisé</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            padding: 20px;
            max-width: 900px;
            margin: auto;
            background-color: #f9f9f9;
            color: #333;
        }
        
        /* --- En-tête --- */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }
        .header img {
            max-width: 250px; /* Ajustez la taille du logo si besoin */
            height: auto;
            margin-bottom: 15px;
        }
        .header .structure-name {
            font-size: 1.8em;
            font-weight: 600;
            color: #2c3e50;
            margin: 10px 0 5px 0;
        }
        .header .author-name {
            font-size: 1.2em;
            color: #7f8c8d;
            margin: 0;
        }
        
        h1, h2, h3, h4 {
            color: #2c3e50;
            font-weight: 600;
        }
        h1 {
            font-size: 2.5em;
            text-align: center;
            border: none;
            color: #34495e;
            margin-bottom: 30px;
        }
        h2 {
            font-size: 2em;
            margin-top: 40px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        h3 {
            font-size: 1.6em;
            margin-top: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        h4 {
            font-size: 1.3em;
            margin-top: 25px;
            color: #3498db;
        }
        hr {
            border: 0;
            height: 1px;
            background: #ddd;
            margin: 50px 0;
        }
        
        /* --- Blocs d'information --- */
        .motivation, .analogy, .warning, .success {
            padding: 18px 25px;
            margin: 25px 0;
            border-radius: 8px;
            border-left: 5px solid;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .motivation { border-color: #007bff; }
        .analogy { border-color: #28a745; }
        .warning { border-color: #faad14; }
        .success { border-color: #52c41a; }
        
        .motivation h3, .analogy h3, .warning h3, .success h3 {
            margin-top: 0;
            border: none;
        }

        /* --- Blocs de code --- */
        .code-block {
            position: relative;
            margin: 25px 0;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            overflow: hidden; /* Pour les coins arrondis */
        }
        .code-header {
            background-color: #333;
            color: #f1f1f1;
            padding: 10px 18px;
            font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace;
            font-size: 0.95em;
            font-weight: bold;
        }
        pre {
            background-color: #282c34; /* Thème sombre */
            color: #abb2bf; /* Texte clair */
            padding: 18px;
            overflow-x: auto;
            margin: 0;
            font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.5;
        }
        code {
            font-family: inherit;
        }
        
        /* Code en ligne */
        p > code, li > code {
            background-color: #ecf0f1;
            color: #c0392b;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        /* Blocs de prompt */
        .prompt-block {
            background-color: #fdfdfd;
            border: 1px dashed #95a5a6;
            padding: 20px;
            border-radius: 5px;
            color: #444;
            margin: 20px 0;
            white-space: pre-wrap;
            font-family: 'Georgia', serif;
        }
        
        ul, ol { 
            padding-left: 25px; 
            line-height: 1.8;
        }
        li { margin-bottom: 12px; }
        strong { color: #2c3e50; }
        a { color: #3498db; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <header class="header">
        <img src="logo_uimm_placeholder.jpg" alt="Logo Pôle Formation UIMM-CVDL">
        <p class="structure-name">Pôle Formation UIMM-CVDL</p>
        <p class="author-name">S. Jaubert</p>
    </header>

    <h1>Tutoriel Complet : Connecter Gemini (IA) à votre Google Drive en toute sécurité</h1>

    <div class="motivation">
        <h3>◉ La Motivation (Le "Pourquoi ?")</h3>
        <p>L'objectif final est de pouvoir <strong>parler à une IA (Gemini)</strong> et lui demander d'automatiser des tâches sur vos fichiers Google, comme : <i>"Va dans ce Google Sheet, trouve toutes les lignes où la colonne B est 'En attente', et mets 'Pour Revue' dans la colonne F."</i></p>
        <p>Le <strong>problème de sécurité</strong> est que, normalement, pour faire cela, vous devriez donner à l'IA un "pass-partout" (un scope <code>.../auth/drive</code>) qui lui donne accès à <strong>tous</strong> vos fichiers. C'est très risqué.</p>
    </div>

    <div class="analogy">
        <h3>◉ L'Analogie : Le Maître d'Hôtel (Notre Solution)</h3>
        <ul>
            <li><strong>La Mauvaise Idée :</strong> Donner à l'IA (le stagiaire) le pass-partout de l'hôtel.</li>
            <li><strong>Notre Solution :</strong> L'IA (le "Maître d'Hôtel") attend dans le hall (le "sandbox").
                <ol>
                    <li>Vous lui donnez une tâche : "Apporter une serviette à la chambre 207".</li>
                    <li>Vous lui donnez <strong>uniquement</strong> la clé de la chambre 207 (le "whitelist d'ID de fichier").</li>
                    <li>L'IA exécute la tâche et vous rend la clé.</li>
                </ol>
            </li>
        </ul>
        <p>Nous allons construire ce "Maître d'Hôtel" sécurisé.</p>
    </div>

    <h2>◉ Le Plan d'Action (Les 3 Grandes Parties)</h2>
    <ol>
        <li><strong>Partie 1 : Construire le Moteur (Setup <code>gas-fakes</code>).</strong> C'est la base. Nous allons configurer l'outil <code>gas-fakes</code> pour qu'il puisse parler à Google. C'est l'étape la plus complexe, car elle implique la console Google Cloud.</li>
        <li><strong>Partie 2 : Installer le Chauffeur IA (Serveur MCP).</strong> Nous installerons le "traducteur" (un serveur MCP) qui permet à Gemini de "donner des ordres" à notre moteur <code>gas-fakes</code>.</li>
        <li><strong>Partie 3 : Le Test de Conduite (Simulation).</strong> Nous lancerons Gemini et lui donnerons nos premières instructions en langage naturel.</li>
    </ol>

    <hr>

    <h2>Partie 1 : Construire le Moteur (Setup <code>gas-fakes</code>)</h2>
    <p>C'est la fondation. Nous allons obtenir les clés de l'atelier Google Cloud.</p>

    <h3>A. Prérequis</h3>
    <ul>
        <li>Node.js installé sur votre PC.</li>
        <li>Un compte Google (un compte <code>@gmail.com</code> personnel est parfait).</li>
    </ul>

    <h3>B. Installation locale</h3>
    <p>Dans votre terminal, créez un dossier pour le projet et installez <code>gas-fakes</code>.</p>
    <div class="code-block">
        <div class="code-header">Terminal (bash)</div>
        <pre><code>mkdir projet-ia-secure
cd projet-ia-secure
npm install @mcpher/gas-fakes</code></pre>
    </div>
    
    <p>Ensuite, <a href="https://github.com/brucemcpherson/gas-fakes/tree/main/shells" target="_blank" rel="noopener noreferrer">téléchargez le dossier <code>shells</code> depuis le dépôt GitHub</a> (lien corrigé) et placez-le dans votre dossier <code>projet-ia-secure</code>.</p>

    <h3>C. Configuration Google Cloud (L'Étape du "Mur")</h3>
    <p>C'est ici que vous étiez bloqué. Suivez ce guide <strong>précisément</strong>. Il est conçu pour contourner les bugs de l'interface Google.</p>

    <h4>1. Créer le Projet "Atelier"</h4>
    <ol>
        <li>Allez sur la <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer">Console Google Cloud Platform</a>.</li>
        <li>Créez un <strong>nouveau projet</strong> (ex: "Mon-Atelier-IA").</li>
        <li>Assurez-vous que ce projet est bien sélectionné en haut de la page.</li>
    </ol>

    <h4>2. Créer le Badge OAuth (L'ID Client)</h4>
    <ol>
        <li>Dans le menu de recherche en haut, tapez <strong>"Identifiants"</strong> (ou "Credentials").</li>
        <li>Cliquez sur <strong>"+ CRÉER DES IDENTIFIANTS"</strong> et choisissez <strong>"ID client OAuth"</strong>.</li>
        <li>Type d'application : <strong>"Application de bureau"</strong> (Desktop app).</li>
        <li>Donnez-lui un nom (ex: "Client Dev Local").</li>
        <li>Cliquez sur <strong>"Créer"</strong>. Une fenêtre s'ouvre.</li>
        <li><strong>IMPORTANT :</strong> Cliquez sur <strong>"TÉLÉCHARGER LE JSON"</strong>.</li>
        <li>Créez un dossier <code>private</code> dans votre projet. Renommez ce fichier <code>credentials.json</code> et placez-le dans <code>projet-ia-secure/private/</code>.</li>
    </ol>

    <h4>3. Configurer l'Écran de Consentement (La Procédure "Anti-Bug")</h4>
    <ol>
        <li>Dans le menu de gauche, cliquez sur <strong>"Écran de consentement OAuth"</strong>.</li>
        <li>Vous verrez le choix : "Interne" (grisé) et "Externe".</li>
        <li>Choisissez <strong>"Externe"</strong> (c'est normal pour un compte <code>@gmail.com</code>) et cliquez sur <strong>"Créer"</strong>.</li>
    </ol>
    <div class="warning">
        <p><strong>Attention :</strong> Vous êtes maintenant sur un formulaire en plusieurs étapes. <strong>NE CLIQUEZ PAS SUR LES ONGLETS DU MENU DE GAUCHE (Branding, Audience...).</strong> Vous devez suivre le flux avec les boutons en bas de page.</p>
    </div>
    
    <p><strong>Page 1 : "Branding" (Informations sur l'application)</strong></p>
    <ul>
        <li><strong>Nom de l'application :</strong> <code>Mon App de Test IA</code></li>
        <li><strong>Adresse e-mail d'assistance... :</strong> Votre email <code>@gmail.com</code></li>
        <li><strong>Logo :</strong> Laissez vide.</li>
        <li><strong>Lien vers la page d'accueil... :</strong> Mettez <code>https://www.google.com</code> (juste pour passer).</li>
        <li><strong>Lien vers les règles de confidentialité... :</strong> Mettez <code>https://policies.google.com/privacy</code> (juste pour passer).</li>
        <li><strong>Domaines autorisés :</strong> Cliquez sur <code>+ AJOUTER UN DOMAINE</code> et entrez <code>google.com</code>.</li>
        <li><strong>Informations de contact du développeur :</strong> <strong>Supprimez</strong> votre email s'il est pré-rempli, puis <strong>retapez-le à la main</strong> et appuyez sur <strong>Entrée</strong>. C'est l'astuce qui débloque le bouton "Continuer".</li>
        <li>Tout en bas, cliquez sur le bouton bleu <strong>"ENREGISTRER ET CONTINUER"</strong>.</li>
    </ul>

    <p><strong>Page 2 : "Scopes" (Champs d'application)</strong></p>
    <ul>
        <li>Cliquez sur <strong>"AJOUTER OU SUPPRIMER DES CHAMPS D'APPLICATION"</strong>.</li>
        <li>Faites défiler tout en bas, dans le champ "Ajouter manuellement les champs d'application".</li>
        <li>Collez cette liste (les scopes les plus courants) :
            <div class="code-block">
                <pre><code>https://www.googleapis.com/auth/spreadsheets
https://www.googleapis.com/auth/drive
https://www.googleapis.com/auth/documents
https://www.googleapis.com/auth/userinfo.email
openid</code></pre>
            </div>
        </li>
        <li>Cliquez sur <strong>"AJOUTER À LA TABLE"</strong>, puis sur le bouton <strong>"METTRE À JOUR"</strong>.</li>
        <li>Tout en bas de la page "Scopes", cliquez sur <strong>"ENREGISTRER ET CONTINUER"</strong>.</li>
    </ul>

    <p><strong>Page 3 : "Test users" (Utilisateurs test)</strong></p>
    <div class="warning">
        <h3>C'EST L'ÉTAPE CRUCIALE</h3>
        <p>Puisque l'application est "Externe", elle est en "Mode Test". Seuls les utilisateurs listés ici peuvent l'utiliser.</p>
    </div>
    <ul>
        <li>Cliquez sur <strong>"+ ADD USERS"</strong>.</li>
        <li>Entrez votre propre adresse email (ex: <code>stephane.jaubert@gmail.com</code>).</li>
        <li>Cliquez sur <strong>"AJOUTER"</strong>.</li>
        <li>Tout en bas, cliquez sur <strong>"ENREGISTRER ET CONTINUER"</strong>.</li>
    </ul>

    <p><strong>Page 4 : "Summary" (Résumé)</strong></p>
    <ul>
        <li>Cliquez sur <strong>"REVENIR AU TABLEAU DE BORD"</strong>.</li>
        <li><strong>IMPORTANT :</strong> NE CLIQUEZ PAS SUR "PUBLIER L'APPLICATION". L'application doit rester en "Testing".</li>
    </ul>

    <h3>D. Configuration Locale (Le <code>.env</code>)</h3>
    <p>Nous allons maintenant dire à <code>gas-fakes</code> où trouver vos clés.</p>
    <ol>
        <li>Ouvrez votre terminal dans le dossier <code>projet-ia-secure</code>.</li>
        <li>Allez dans le dossier <code>shells</code> :
            <div class="code-block">
                <div class="code-header">Terminal (bash)</div>
                <pre><code>cd shells</code></pre>
            </div>
        </li>
        <li>Exécutez le script de configuration :
            <div class="code-block">
                <div class="code-header">Terminal (bash)</div>
                <pre><code>./setup.sh</code></pre>
            </div>
        </li>
        <li>Le script va vous poser des questions :
            <ul>
                <li><strong><code>Enter GCP_PROJECT_ID</code> :</strong> Entrez l'ID de votre projet (ex: <code>mon-atelier-ia-123456</code>). Vous le trouvez sur la page d'accueil de la console GCP.</li>
                <li><strong><code>Enter CLIENT_CREDENTIAL_FILE</code> :</strong> Entrez le chemin vers votre fichier JSON : <code>../private/credentials.json</code> (le <code>../</code> est pour "remonter" d'un dossier).</li>
                <li>Pour toutes les autres questions (<code>DRIVE_TEST_FILE_ID</code>, <code>STORE_TYPE</code>...), appuyez simplement sur <strong>Entrée</strong> pour accepter les valeurs par défaut.</li>
            </ul>
        </li>
    </ol>

    <h3>E. Autorisation Finale (La Connexion)</h3>
    <p>Toujours dans le dossier <code>shells/</code> :</p>
    <ol>
        <li><strong>Lancez l'autorisation :</strong>
            <div class="code-block">
                <div class="code-header">Terminal (bash)</div>
                <pre><code>bash setaccount.sh</code></pre>
            </div>
        </li>
        <li>Votre navigateur va s'ouvrir.</li>
        <li>Vous verrez un <strong>grand écran rouge d'avertissement</strong> ("Google n'a pas validé cette application"). <strong>C'EST NORMAL.</strong> C'est parce que votre application est en "Mode Test".</li>
        <li>Cliquez sur "Paramètres avancés", puis sur <strong>"Accéder à [Nom de votre app] (non sécurisé)"</strong>.</li>
        <li>Cochez les cases pour autoriser les permissions (Drive, Sheets...) que vous avez ajoutées.</li>
        <li><strong>Activez les Outils (APIs) :</strong>
            <div class="code-block">
                <div class="code-header">Terminal (bash)</div>
                <pre><code>bash enable.sh</code></pre>
            </div>
            (Cela peut prendre une minute).
        </li>
    </ol>

    <h3>F. Fichiers de Projet (Le "Casier")</h3>
    <p>Retournez à la racine de votre projet (<code>cd ..</code>). Créez deux fichiers de configuration :</p>

    <ol>
        <li><strong><code>appsscript.json</code></strong> (pour lister les permissions) :</li>
    </ol>
    <div class="code-block">
        <div class="code-header">appsscript.json</div>
        <pre><code>{
  "oauthScopes": [
    "https://www.googleapis.com/auth/spreadsheets",
    "https://www.googleapis.com/auth/drive",
    "https://www.googleapis.com/auth/documents",
    "https://www.googleapis.com/auth/userinfo.email",
    "openid"
  ]
}</code></pre>
    </div>

    <ol start="2">
        <li><strong><code>gasfakes.json</code></strong> (pour donner un "numéro de casier" unique à votre projet) :</li>
    </ol>
    <div class="code-block">
        <div class="code-header">gasfakes.json</div>
        <pre><code>{
  "manifest": "./appsscript.json",
  "scriptId": "mon-projet-ia-secure-001"
}</code></pre>
    </div>
    
    <div class="success">
        <h3>FÉLICITATIONS !</h3>
        <p>La Partie 1 est terminée. Le "Moteur" est construit et fonctionnel.</p>
    </div>

    <hr>

    <h2>Partie 2 : Installer le Chauffeur IA (Serveur MCP)</h2>
    <p>Maintenant que le moteur tourne, nous allons y connecter le "Chauffeur" (Gemini).</p>

    <h3>A. Installation des Outils (le "Traducteur")</h3>
    <p>Dans votre terminal, à la racine de <code>projet-ia-secure</code>, installez les modules pour le serveur MCP :</p>
    <div class="code-block">
        <div class="code-header">Terminal (bash)</div>
        <pre><code>npm install @modelcontextprotocol/sdk zod</code></pre>
    </div>

    <h3>B. Le Script Serveur (<code>gas-fakes-mcp.js</code>)</h3>
    <p>Créez un fichier nommé <code>gas-fakes-mcp.js</code> à la racine de votre projet. C'est le "Maître d'Hôtel" qui écoutera Gemini.</p>
    <div class="code-block">
        <div class="code-header">gas-fakes-mcp.js</div>
        <pre><code>import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";
import { StdioServerTransport } from "@modelcontextprotocol/sdk/server/stdio.js";
import { exec } from "child_process";
import fs from "fs/promises";
import { setTimeout } from "node:timers/promises";
import { promisify } from "util";
import { z } from "zod";

const server = new McpServer({
  name: "Serveur MCP pour gas-fakes",
  version: "0.0.1",
});

const execAsync = promisify(exec);

const tool = {
  name: "run_gas_with_gas-fakes", // Le nom de l'outil que Gemini utilisera
  schema: {
    description:
      "Exécute un script Google Apps Script dans un 'sandbox' sécurisé via gas-fakes.",
    inputSchema: {
      gas_script: z
        .string()
        .describe(
          `Le script Google Apps Script à exécuter.
           IMPORTANT: Utiliser 'console.log()' au lieu de 'Logger.log()'.
           Si le script est dans une fonction, ne pas oublier de l'appeler (ex: maFonction();).`
        ),
      whitelistItems: z
        .array(z.string().describe(`ID de fichier sur Google Drive`))
        .describe(
          `LISTE BLANCHE : IDs des fichiers (Sheets, Docs...) auxquels ce script a le droit d'accéder.`
        )
        .optional(),
      sandbox: z
        .boolean()
        .describe(
          `'true' (défaut) : Mode sécurisé. Le script ne peut rien faire en dehors de la whitelist.
           'false' : Mode non-sécurisé.`
        ),
    },
  },
  func: async (object = {}) => {
    const { sandbox = true, whitelistItems = [], gas_script } = object;
    const importFile = "./script_ia_temporaire.mjs"; // Fichier temporaire

    function getImportScript() {
      const importScriptAr = [
        // Importe gas-fakes pour simuler l'environnement
        `import "./node_modules/@mcpher/gas-fakes/main.js"`,
        "",
      ];
      if (whitelistItems.length === 0) {
        // Mode Sandbox STANDARD (autorisé à créer de nouveaux fichiers)
        importScriptAr.push(
          sandbox ? `ScriptApp.__behavior.sandBoxMode = true;` : "",
          `\n\n${gas_script}\n\n`,
          // Met à la corbeille tous les fichiers créés pendant ce script
          sandbox ? `ScriptApp.__behavior.trash();` : ""
        );
      } else {
        // Mode Sandbox STRICT (uniquement la whitelist)
        const wl = whitelistItems
          .map((id) => `behavior.newIdWhitelistItem("${id}").setWrite(true)`)
          .join(",");
        importScriptAr.push(
          `const behavior = ScriptApp.__behavior;`,
          `behavior.sandboxMode = true;`,
          `behavior.strictSandbox = true;`, // N'autorise QUE la whitelist
          `behavior.setIdWhitelist([${wl}]);`, // Applique la whitelist
          `\n\n${gas_script}\n\n`,
          `ScriptApp.__behavior.trash();`
        );
      }
      return importScriptAr.join("\n");
    }

    try {
      // 1. Écrit le script de l'IA dans un fichier
      const importScript = getImportScript();
      await fs.writeFile(importFile, importScript);
      await setTimeout(500); // Laisse le temps au fichier d'être écrit

      // 2. Exécute le fichier avec Node.js
      const { stdout } = await execAsync(`node ./${importFile}`);
      return {
        content: [{ type: "text", text: stdout || "Terminé." }],
        isError: false,
      };
    } catch (err) {
      // 3. Renvoie une erreur à Gemini si le script échoue
      return {
        content: [{ type: "text", text: err.message }],
        isError: true,
      };
    } finally {
      // 4. Supprime toujours le fichier temporaire
      try {
        await fs.unlink(importFile);
      } catch (err) {
        console.error(err.message);
      }
    }
  },
};

const { name, schema, func } = tool;
server.registerTool(name, schema, func);

const transport = new StdioServerTransport();
await server.connect(transport);
</code></pre>
    </div>

    <h3>C. Configuration de Gemini (Le "GPS")</h3>
    <ol>
        <li>Installez le <a href="https://github.com/google/gemini-cli" target="_blank" rel="noopener noreferrer">Gemini CLI</a> si ce n'est pas déjà fait.</li>
        <li>Trouvez le fichier <code>settings.json</code> du Gemini CLI (souvent dans votre dossier utilisateur, dans un dossier <code>.gemini</code>).</li>
        <li>Modifiez ce fichier pour y ajouter la section <code>mcpServers</code>.</li>
    </ol>
    <div class="warning">
        <p><strong>Attention :</strong> Vous devez utiliser le <strong>chemin absolu</strong> vers votre script.
        <ul>
            <li>Sur Windows, ce sera (par exemple) : <code>C:\\Utilisateurs\\Stephane\\projet-ia-secure\\gas-fakes-mcp.js</code> (notez les doubles <code>\\</code>).</li>
            <li>Sur Mac/Linux, ce sera (par exemple) : <code>/home/stephane/projet-ia-secure/gas-fakes-mcp.js</code></li>
        </ul>
        </p>
    </div>
    
    <div class="code-block">
        <div class="code-header">.gemini/settings.json</div>
        <pre><code>{
  "security": {
    "auth": {
      "selectedType": "..."
    }
  },
  "ui": {
    "theme": "Default"
  },
  "mcpServers": {
    "gas-fakes": {
      "command": "node",
      "args": ["VOTRE_CHEMIN_ABSOLU_VERS/projet-ia-secure/gas-fakes-mcp.js"]
    }
  }
}</code></pre>
    </div>

    <hr>

    <h2>Partie 3 : Le Test de Conduite (Simulation)</h2>
    <p>Tout est prêt. Lançons le test !</p>
    <ol>
        <li>Ouvrez votre terminal (dans le dossier <code>projet-ia-secure</code>).</li>
        <li>Lancez Gemini :
            <div class="code-block">
                <div class="code-header">Terminal (bash)</div>
                <pre><code>gemini</code></pre>
            </div>
        </li>
        <li>Gemini va démarrer et vous dire qu'il a <strong>chargé l'outil <code>gas-fakes</code></strong>. C'est la preuve que la connexion est réussie.</li>
    </ol>

    <h3>Exemple 1 : Sandbox Standard (Créer un fichier)</h3>
    <p>Donnez ce prompt à Gemini :</p>
    <div class="prompt-block">
Crée un script GAS pour :
1. Créer un Google Doc nommé "Test IA Sandbox".
2. Ajouter le texte "Bonjour le monde" dedans.
3. Afficher l'ID du document avec console.log().
Ensuite, exécute ce script.
    </div>

    <p><strong>Ce qui se passe :</strong></p>
    <ol>
        <li>Gemini génère le script (avec <code>DocumentApp.create()</code>).</li>
        <li>Il appelle votre outil <code>run_gas_with_gas-fakes</code> avec le script.</li>
        <li><code>gas-fakes</code> l'exécute, crée le fichier <strong>réellement</strong> dans votre Google Drive.</li>
        <li>Il affiche l'ID du fichier dans votre terminal.</li>
        <li>Il met immédiatement le fichier "Test IA Sandbox" à la <strong>corbeille</strong> (à cause de <code>ScriptApp.__behavior.trash();</code>).</li>
    </ol>

    <h3>Exemple 2 : Sandbox Sécurisé (Lire un fichier)</h3>
    <p>C'est le test ultime.</p>
    <ol>
        <li>Créez un Google Sheet dans votre Drive. Mettez "Pomme" dans la cellule A1.</li>
        <li>Copiez l'ID de ce Google Sheet (depuis l'URL, ex: <code>.../d/ID_DU_FICHIER/edit</code>).</li>
        <li>Donnez ce prompt à Gemini (en remplaçant <code>[VOTRE_ID_DE_FICHIER]</code>) :</li>
    </ol>
    <div class="prompt-block">
Crée un script GAS pour :
1. Ouvrir le Spreadsheet par son ID : "[VOTRE_ID_DE_FICHIER]"
2. Lire la valeur de la cellule A1 de la première feuille.
3. Afficher cette valeur avec console.log().
Ensuite, exécute ce script en ajoutant "[VOTRE_ID_DE_FICHIER]" à la whitelist.
    </div>

    <p><strong>Ce qui se passe :</strong></p>
    <ol>
        <li>Gemini génère le script (avec <code>SpreadsheetApp.openById(...)</code>).</li>
        <li>Il appelle votre outil en passant le <code>gas_script</code> ET <code>whitelistItems: ["[VOTRE_ID_DE_FICHIER]"]</code>.</li>
        <li>Votre serveur <code>gas-fakes-mcp.js</code> active le <strong>mode strict</strong> et n'autorise l'accès qu'à cet ID.</li>
        <li>Le script s'exécute et affiche <strong>"Pomme"</strong> dans votre terminal.</li>
    </ol>
    
    <div class="success">
        <h3>Mission Accomplie</h3>
        <p>Vous avez maintenant un assistant IA sécurisé, connecté à votre Google Workspace. Si l'IA avait essayé d'ouvrir <i>un autre fichier</i>, <code>gas-fakes</code> l'aurait bloqué avec une erreur de permission.</p>
    </div>

</body>
</html>