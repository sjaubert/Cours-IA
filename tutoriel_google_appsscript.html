<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutoriel : Pilotez Google Apps Script avec l'IA</title>
    <style>
        /* --- Styles G√©n√©raux --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.7;
            background-color: #f8f9fa;
            color: #212529;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px 40px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07);
        }

        /* --- Typographie --- */
        h1, h2, h3 {
            color: #343a40;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-top: 40px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        h1 {
            font-size: 2.8em;
            text-align: center;
            border-bottom: 3px solid #0d6efd;
        }
        h2 {
            font-size: 2.2em;
        }
        h3 {
            font-size: 1.6em;
            border-bottom: 1px solid #dee2e6;
        }
        p, li {
            font-size: 1.1em;
            color: #495057;
        }
        strong {
            color: #0d6efd;
        }
        em {
            font-style: italic;
            color: #555;
        }
        
        /* --- Listes --- */
        ul, ol {
            padding-left: 30px;
        }
        li {
            margin-bottom: 10px;
        }

        /* --- Bloc de Code et Bouton Copier --- */
        .code-container {
            position: relative;
            margin: 25px 0;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 25px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 0.95em;
            line-height: 1.5;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: #0d6efd;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .copy-btn:hover {
            background-color: #0b5ed7;
        }
        .copy-btn:active {
            transform: scale(0.95);
        }
        .copy-btn.copied {
            background-color: #198754; /* Vert succ√®s */
        }
        
        /* --- Alertes / Blocs d'information --- */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid transparent;
        }
        .alert-info {
            background-color: #e6f7ff;
            border-color: #b3e0ff;
            color: #0056b3;
        }
        .alert-warning {
            background-color: #fffbe6;
            border-color: #ffe58f;
            color: #664d03;
        }

        /* --- Responsive --- */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 10px;
            }
            h1 { font-size: 2.2em; }
            h2 { font-size: 1.8em; }
            h3 { font-size: 1.4em; }
            p, li { font-size: 1em; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Pilotez Google Apps Script avec l'IA</h1>
         <img src="logo_uimm_placeholder.jpg" alt="Logo de l'institution" class="h-10 w-10 object-contain">
<p><b>P√¥le Formation UIMM CVDL (S. Jaubert)</b></p>

       
        
        <p>L'objectif de ce tutoriel est simple : vous allez prendre le contr√¥le de votre environnement Google. Nous allons transformer votre suite Google en un assistant personnel qui travaille pour vous, 24/7.</p>

        <h2>Qu'est-ce que Google Apps Script ?</h2>

        <p>Pour le dire simplement : c'est le <strong>cerveau cach√©</strong> qui peut connecter <em>tous</em> vos outils Google.</p>
        <ul>
            <li><strong>L'Analogie :</strong> Pensez √† vos outils Google (Sheets, Docs, Gmail...) comme √† des √Æles s√©par√©es. Apps Script est le constructeur de ponts.</li>
            <li><strong>La R√©volution :</strong> Avant, il fallait √™tre ing√©nieur pour construire ces ponts. Maintenant, il suffit de d√©crire le pont √† une IA et elle vous donne les plans.</li>
        </ul>
        <p>Vous n'√™tes plus un simple utilisateur. Vous devenez un architecte de vos propres solutions.</p>

        <h2>Partie 1 : Acc√©der au Cerveau (Votre Premier Script)</h2>
        <p>Pas besoin de t√©l√©charger quoi que ce soit. L'√©diteur de script est d√©j√† dans vos outils.</p>
        <ol>
            <li>Ouvrez un nouveau Google Sheet (tapez <code>sheet.new</code> dans votre navigateur).</li>
            <li>Allez dans le menu : <strong>Extensions</strong> > <strong>Apps Script</strong>.</li>
            <li>Une nouvelle fen√™tre s'ouvre. C'est votre "tour de contr√¥le". Vous verrez un fichier nomm√© <code>Code.gs</code>. C'est l√† que nous allons coller le code g√©n√©r√© par l'IA.</li>
        </ol>

        <h2>Partie 2 : La M√©thode Magique (Piloter l'IA pour coder)</h2>
        <p>Voici le processus en 5 √©tapes que nous allons utiliser <em>√† chaque fois</em>.</p>

        <h3>√âtape 1 : Formuler le Besoin (Le "Brief") üéØ</h3>
        <p>C'est l'√©tape la plus importante. Vous devez √™tre hyper-pr√©cis.</p>
        <ul>
            <li><strong>Mauvais brief :</strong> "J'aimerais automatiser mes factures." (Trop vague)</li>
            <li><strong>Bon brief :</strong> "Je veux un script Google Apps Script. Quand un nouveau fichier PDF est ajout√© √† mon dossier Drive 'Factures 2024' (ID: 123xyz), le script doit : 1. Lire le nom du fichier. 2. Ajouter une nouvelle ligne dans mon Google Sheet 'Suivi Compta' (URL: ...) 3. Inscrire le nom du fichier dans la colonne A et la date d'aujourd'hui dans la colonne B."</li>
        </ul>

        <h3>√âtape 2 : Demander √† l'IA (La G√©n√©ration) ü§ñ</h3>
        <p>Vous ouvrez une IA (comme Gemini) et vous lui donnez votre "Bon brief". Vous lui dites : "<strong>√âcris-moi le code Google Apps Script complet pour faire cela.</strong>"</p>

        <h3>√âtape 3 : Copier et Coller (L'Implantation) üìã</h3>
        <ol>
            <li>L'IA va vous g√©n√©rer un bloc de code. Vous copiez tout.</li>
            <li>Vous retournez dans votre fen√™tre Apps Script (le <code>Code.gs</code>).</li>
            <li>Vous effacez tout ce qui s'y trouve et vous collez votre nouveau code.</li>
            <li>Vous cliquez sur l'ic√¥ne <strong>Enregistrer</strong>.</li>
        </ol>

        <h3>√âtape 4 : Autoriser (La Cl√© de Contact) üîë</h3>
        <p>C'est une √©tape cruciale la <em>premi√®re fois</em>.</p>
        <ol>
            <li>Cliquez sur le bouton <strong>Ex√©cuter</strong> (le triangle ‚ñ∫).</li>
            <li>Google va vous dire "Autorisation requise". Cliquez sur "Examiner les autorisations".</li>
            <li>Choisissez votre compte Google.</li>
            <li>Vous verrez un avertissement. Cliquez sur "Param√®tres avanc√©s", puis sur "<strong>Acc√©der √† [Nom de votre script] (non s√©curis√©)</strong>".</li>
            <li>Acceptez toutes les autorisations.</li>
        </ol>

        <h3>√âtape 5 : Tester et Regarder la Magie (L'Ex√©cution) ‚ú®</h3>
        <p>Maintenant, retournez sur votre document et faites l'action qui doit d√©clencher le script. Observez la magie op√©rer.</p>
        
        <h2>Partie 3 : Simulation (L'Onboarding RH)</h2>
        <p><strong>Objectif :</strong> Automatiser l'arriv√©e d'un nouveau salari√©. (Google Sheet > G√©n√®re Doc > Range dans Drive).</p>

        <h3>√âtape A : La Base de Donn√©es (Le Google Sheet)</h3>
        <p>Cr√©ez un Google Sheet avec ces colonnes :<br>
        <code>A: Nom Complet</code> | <code>B: Poste</code> | <code>C: Manager</code> | <code>D: Date d'arriv√©e</code> | <code>E: Email</code> | <code>F: Statut</code>
        </p>

        <h3>√âtape B : Le Mod√®le (Le Google Doc)</h3>
        <p>Cr√©ez un Google Doc mod√®le. L√† o√π les donn√©es doivent changer, utilisez des <strong>variables</strong> entre accolades.
        <br><em>Exemple : "Bienvenue √† <strong>{{Nom Complet}}</strong> au poste de <strong>{{Poste}}</strong>."</em>
        <br>Notez l'ID de ce document (dans l'URL).
        </p>

        <h3>√âtape C : Le Brief pour l'IA</h3>
        <p>Voici un exemple de prompt parfait √† donner √† l'IA :</p>
        <div class="alert alert-warning">
            <p><strong>Prompt pour l'IA :</strong></p>
            <p>"Tu es un expert Google Apps Script.<br>
            <strong>Contexte :</strong> J'ai un Google Sheet 'Onboarding' (ID: <code>[METTEZ VOTRE ID]</code>) avec les colonnes A: Nom Complet, B: Poste, C: Manager, D: Date d'arriv√©e, E: Email, F: Statut.
            J'ai un Google Doc mod√®le (ID: <code>[VOTRE ID MOD√àLE]</code>) et un dossier Drive 'Contrats Sign√©s' (ID: <code>[VOTRE ID DOSSIER]</code>).<br>
            <strong>D√©clencheur :</strong> Le script doit se lancer automatiquement quand j'√©cris 'Pr√™t' dans la colonne F (Statut).<br>
            <strong>Actions :</strong>
            1. D√©tecter l'√©dition 'Pr√™t' en colonne F.
            2. Lire les donn√©es de la ligne modifi√©e.
            3. Faire une copie du Doc mod√®le.
            4. Remplacer les variables (ex: <code>{{Nom Complet}}</code>) avec les donn√©es du Sheet.
            5. Renommer le nouveau Doc : 'Contrat - [Nom Complet]'.
            6. Ranger ce Doc dans le dossier 'Contrats Sign√©s'.
            7. √âcrire 'Contrat G√©n√©r√©' dans la colonne F."
            </p>
        </div>

        <h3>√âtape D : Le Code G√©n√©r√© (Exemple)</h3>
        <p>L'IA vous donnera quelque chose comme √ßa. Copiez-le dans votre √©diteur <code>Code.gs</code>.</p>
        
        <div class="code-container">
            <pre><code class="language-javascript">
// IDs √† personnaliser (REMPLISSEZ-LES AVEC VOS PROPRES IDs)
const SHEET_ID = 'METTEZ_L_ID_DE_VOTRE_SHEET';
const TEMPLATE_DOC_ID = 'METTEZ_L_ID_DE_VOTRE_DOC_MOD√àLE';
const TARGET_FOLDER_ID = 'METTEZ_L_ID_DE_VOTRE_DOSSIER_DRIVE';

/**
 * Fonction qui se d√©clenche √† chaque √©dition du Google Sheet.
 * @param {Object} e - L'objet d'√©v√©nement qui contient les infos sur l'√©dition
 */
function onEdit(e) {
  
  const range = e.range; // La cellule qui a √©t√© modifi√©e
  const sheet = range.getSheet(); // La feuille active
  
  const editedRow = range.getRow(); // Num√©ro de la ligne modifi√©e
  const editedCol = range.getColumn(); // Num√©ro de la colonne modifi√©e
  
  const statusColumn = 6; // Colonne F
  const triggerText = 'Pr√™t';
  
  // Si la modification n'est pas dans la colonne F OU si le texte n'est pas "Pr√™t"
  if (editedCol !== statusColumn || range.getValue() !== triggerText) {
    return; // On arr√™te le script
  }
  
  // 1. Lire les donn√©es de la ligne
  // getRange(ligne, colonne_d√©but, nb_lignes, nb_colonnes)
  const dataRange = sheet.getRange(editedRow, 1, 1, 5); // Colonnes A √† E
  const data = dataRange.getValues()[0]; // [Nom, Poste, Manager, Date, Email]
  
  const nomComplet = data[0];
  const poste = data[1];
  const manager = data[2];
  const dateArrivee = new Date(data[3]).toLocaleDateString('fr-FR'); // Formatage de la date
  const email = data[4];

  // 2. Acc√©der aux dossiers et au mod√®le
  const templateDoc = DriveApp.getFileById(TEMPLATE_DOC_ID);
  const targetFolder = DriveApp.getFolderById(TARGET_FOLDER_ID);
  
  // 3. Cr√©er la copie et la renommer
  const newFileName = 'Contrat - ' + nomComplet;
  const newDoc = templateDoc.makeCopy(newFileName, targetFolder); // Copie + Rangement
  
  // 4. Remplacer les variables dans le nouveau document
  const docBody = DocumentApp.openById(newDoc.getId()).getBody();
  
  docBody.replaceText('{{Nom Complet}}', nomComplet);
  docBody.replaceText('{{Poste}}', poste);
  docBody.replaceText('{{Manager}}', manager);
  docBody.replaceText('{{Date d\'arriv√©e}}', dateArrivee);
  // Ajoutez autant de replaceText que de variables
  
  // 5. Mettre √† jour le statut dans le Sheet
  const statusCell = sheet.getRange(editedRow, statusColumn);
  statusCell.setValue('Contrat G√©n√©r√©');
  
  Logger.log('Contrat g√©n√©r√© pour ' + nomComplet); // Pour le d√©bogage
}
            </code></pre>
            <button class="copy-btn">Copier</button>
        </div>

        <h3>√âtape E : Tester</h3>
        <ol>
            <li><strong>Enregistrez</strong> le script.</li>
            <li><strong>Autorisez-le</strong> (voir Partie 2, √âtape 4).</li>
            <li>Allez dans votre Google Sheet.</li>
            <li>Remplissez une ligne avec des infos de test.</li>
            <li>Dans la colonne F, tapez <strong>Pr√™t</strong> et appuyez sur Entr√©e.</li>
            <li>Regardez la cellule F passer √† "Contrat G√©n√©r√©" et v√©rifiez votre dossier Drive !</li>
        </ol>

        <h2>Partie 4 : Aller plus loin (Boutons et D√©clencheurs)</h2>
        <p>Parfois, on veut un <strong>bouton</strong> pour lancer une action manuellement.</p>

        <h3>Cr√©er un Menu Personnalis√©</h3>
        <p>Ajoutez ce code <em>en plus</em> de votre fonction <code>onEdit</code> (dans le m√™me fichier <code>Code.gs</code>).</p>
        
        <div class="code-container">
            <pre><code class="language-javascript">
/**
 * Se lance √† l'ouverture du document.
 * Cr√©e un menu personnalis√© dans l'interface du Sheet.
 */
function onOpen() {
  const ui = SpreadsheetApp.getUi();
  ui.createMenu('ü§ñ Outils RH')
      .addItem('G√©n√©rer le contrat (Ligne s√©lectionn√©e)', 'genererContratManuellement')
      .addToUi();
}

/**
 * Fonction manuelle pour g√©n√©rer le contrat de la ligne active.
 */
function genererContratManuellement() {
  // R√©cup√©rez les IDs du d√©but du script (vous pouvez les red√©finir ici ou les rendre globales)
  // const TEMPLATE_DOC_ID = '...';
  // const TARGET_FOLDER_ID = '...';

  const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  const range = sheet.getActiveRange(); // La cellule s√©lectionn√©e par l'utilisateur
  const editedRow = range.getRow();
  
  // 1. Lire les donn√©es
  const data = sheet.getRange(editedRow, 1, 1, 5).getValues()[0];
  const nomComplet = data[0];
  const poste = data[1];
  const manager = data[2];
  const dateArrivee = new Date(data[3]).toLocaleDateString('fr-FR');
  
  // 2. Acc√©der aux dossiers et au mod√®le
  const templateDoc = DriveApp.getFileById(TEMPLATE_DOC_ID); // Assurez-vous que cette variable est accessible
  const targetFolder = DriveApp.getFolderById(TARGET_FOLDER_ID); // Assurez-vous que cette variable est accessible

  // 3. Cr√©er la copie et la renommer
  const newFileName = 'Contrat - ' + nomComplet;
  const newDoc = templateDoc.makeCopy(newFileName, targetFolder);
  
  // 4. Remplacer les variables
  const docBody = DocumentApp.openById(newDoc.getId()).getBody();
  docBody.replaceText('{{Nom Complet}}', nomComplet);
  docBody.replaceText('{{Poste}}', poste);
  docBody.replaceText('{{Manager}}', manager);
  docBody.replaceText('{{Date d\'arriv√©e}}', dateArrivee);
  
  // 5. Mettre √† jour le statut
  sheet.getRange(editedRow, 6).setValue('Contrat G√©n√©r√© (Manuel)');
  
  // 6. Alerte de confirmation
  SpreadApp.getUi().alert('Contrat pour ' + nomComplet + ' a √©t√© g√©n√©r√© avec succ√®s !');
}
            </code></pre>
            <button class="copy-btn">Copier</button>
        </div>

        <p><strong>R√©sultat :</strong> Enregistrez et <strong>rechargez</strong> votre Google Sheet. Un nouveau menu "ü§ñ Outils RH" appara√Æt en haut !</p>

        <h2>Partie 5 : D'autres Id√©es (Les Cas d'Usage)</h2>
        <p>Ce que vous venez de faire n'est que le d√©but. Voici ce qui devient possible :</p>
        
        <h3>1. Les factures qui se classent sans effort</h3>
        <p><strong>Logique :</strong> Un d√©clencheur sur <strong>Google Drive</strong> (quand un fichier est ajout√©) qui lit le PDF et √©crit dans un Sheet.</p>

        <h3>2. Les inscriptions qui se g√®rent toutes seules</h3>
        <p><strong>Logique :</strong> Un d√©clencheur sur <strong>Google Forms</strong> (quand un formulaire est soumis) qui cr√©e un dossier Drive pour l'inscrit et envoie un mail de bienvenue via <strong>Gmail</strong>.</p>
        
        <h3>3. Les attestations toujours √† l‚Äôheure</h3>
        <p><strong>Logique :</strong> Comme notre simulation. Un statut "Termin√©" dans un Sheet d√©clenche la cr√©ation d'un PDF depuis un mod√®le et l'envoie par <strong>Gmail</strong>.</p>

        <h3>4. Le suivi p√©dagogique qui se met √† penser</h3>
        <p><strong>Logique :</strong> Un d√©clencheur <strong>temporel</strong> (tous les jours √† 18h) qui scanne un Sheet. Si un √©l√®ve d√©croche, le script envoie un mail au tuteur et cr√©e un √©v√©nement dans son <strong>Google Calendar</strong>.</p>

        <h3>5. Les dossiers d‚Äô√©valuation qui s‚Äôassemblent tout seuls</h3>
        <p><strong>Logique :</strong> Un bouton qui, pour chaque √©l√®ve d'un Sheet, va chercher tous ses documents dans un dossier Drive, les copie et les assemble dans un "Dossier Final" partag√© au jury.</p>

        <h2>Conclusion : Votre Nouveau R√¥le</h2>
        <p class="alert alert-info">
            Vous l'avez vu : le code est complexe, mais la <strong>demande</strong> est simple.<br><br>
            Votre valeur ajout√©e n'est plus de savoir √©crire <code>function onEdit(e)</code>. Votre valeur ajout√©e est de pouvoir imaginer un processus comme "Quand le statut passe √† 'Pr√™t', prends ce mod√®le, remplace ce texte, et range-le ici."<br><br>
            L'IA est un traducteur ultra-rapide entre votre besoin m√©tier et le langage machine. <strong>Votre seule limite est d√©sormais la clart√© de votre pens√©e.</strong>
        </p>
    </div>

    <script>
        // --- Script pour les boutons "Copier" ---
        document.addEventListener('DOMContentLoaded', () => {
            const allCopyButtons = document.querySelectorAll('.copy-btn');
            
            allCopyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeContainer = button.parentElement;
                    const pre = codeContainer.querySelector('pre');
                    
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(pre.innerText).then(() => {
                            button.innerText = 'Copi√© !';
                            button.classList.add('copied');
                            
                            setTimeout(() => {
                                button.innerText = 'Copier';
                                button.classList.remove('copied');
                            }, 2000); // Revient √† l'√©tat initial apr√®s 2 secondes
                        }).catch(err => {
                            console.error('Erreur lors de la copie', err);
                            button.innerText = 'Erreur';
                        });
                    } else {
                        console.error('L\'API Clipboard n\'est pas support√©e par ce navigateur.');
                        button.innerText = 'Erreur';
                    }
                });
            });
        });
    </script>

</body>
</html>